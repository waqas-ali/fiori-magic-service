<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Hello App Engine</title>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>
  </head>

  <body>
 <script type="text/javascript" src="http://www.webtoolkit.info/djs/webtoolkit.aim.js"></script>
  <script type="text/javascript">
  var webhost="";
  var submissionId='';
  var userId='';
		function startCallback() {
			// make something useful before submit (onStart)
			return true;
		}

		function completeCallback(response) {
			// make something useful after (onComplete)
		console.log(response);
		}
  $(document).ready(function(){
    /*
	 
     	   $.ajax({
		      url: webhost+"/odata.svc/User",
		      type: "POST",
		      //contentType: "application/json;odata=verbose",
		      contentType: 'application/json; charset=utf-8',
		      async:false,
		      data: JSON.stringify({"userName":"test1@test.com","password":"test1"}),
		      dataType: "json",
				      success: function (data) {
				    	  console.log(data);
								    	  $.ajax({
								    	      url: webhost+"/odata.svc/UserRole",
								    	      type: "POST",
								    	      async:false,
								    	      //contentType: "application/json;odata=verbose",
								    	      contentType: 'application/json; charset=utf-8',
								    	      data: JSON.stringify({"userId":data.d.userId,"roleTypeId":6597069766656000}),
								    	      dataType: "json",
								    	      success: function (data) {
								    					console.log(data);
								    	      }
					     				 });
								      }
      }); */
/*
      
	    /* $.ajax({
    	      url: webhost+"/odata.svc/Domain",
    	      type: "POST",
    	      //contentType: "application/json;odata=verbose",
    	      contentType: 'application/json; charset=utf-8',
    	      data:JSON.stringify({"name":"customer.com"}),
    	      dataType: "json",
    		  success: function (data) { console.log(data);}
	      });  
        */
	 $.ajax({
		      url: webhost+"/odata.svc/User?$filter=userName eq 'test1@test.com' and password eq 'test1' ",
		      type: "GET",
		      //contentType: "application/json;odata=verbose",
		      contentType: 'application/json; charset=utf-8',
		      async:false,
		      dataType: "json",
				      success: function (data) {
                        console.log(data.userId);
				          var count=3;
							      $.ajax({
						    	      url: webhost+"/odata.svc/Submission",
						    	      type: "POST",
						    	      async:false,
						    	      //contentType: "application/json;odata=verbose",
						    	      contentType: 'application/json; charset=utf-8',
						    	      data: JSON.stringify({"trip":"kashmir","count":count,"userId":data.userId}),
						    	      dataType: "json",
						    	      success: function (data) {
						    	    	  submissionId=data.d.submissionId;
						                // var urls=(data.d.blobUrls).split("[")[1].split("]")[0];
						            //     var a=urls.split(",");
						               // 	 console.log(a[0]+"2"+a[1]);
						                //  $('#form1').attr('action',a[0]);
						               //   $('#submissionid').attr('value',data.d.submissionId); 
											    console.log(data.d.blobUrls);
											   var urls=(data.d.blobUrls).split("[")[1].split("]")[0];
										       var a=urls.split(",");
										      	 console.log(a[0]+"2"+a[1]);
										        $('#action1').attr('action',a[0]);
										        $('#action2').attr('action',a[1]);
										        $('.submissionid').attr('value',data.d.submissionId);
										      	$('.submissionid').attr('value',data.d.submissionId); 
										      	$('#action3').attr('action',a[2]);
										     	$('.submissionid').attr('value',data.d.submissionId); 
						    	    	 $.ajax({
						    	    	      url: webhost+"/odata.svc/Result",
						    	    	      type: "POST",
						    	    	      async:false,
						    	    	      //contentType: "application/json;odata=verbose",
						    	    	      contentType: 'application/json; charset=utf-8',
						    	    	      data: JSON.stringify({"submissionId":data.d.submissionId,"vendor":"xyz","total":100.00,"tax":0.0,"currency":"Rs","category":"food"}),
						    	    	      dataType: "json",
						    	    	      success: function (data) {
						    							console.log(data);
						    	    	      }
						    		      });    
						              }
							      });
							      
				      }  
				       
		  });  
		   /* $.ajax({
    	      url: webhost+"/odata.svc/Result(5504155208646656)",
    	      type: "PUT",
    	      async:false,
    	      //contentType: "application/json;odata=verbose",
    	      contentType: 'application/json; charset=utf-8',
    	      data: JSON.stringify({"submissionId":6603666836422656,"vendor":"xyz","total":100.00,"tax":0.0,"currency":"Rs","category":"food"}),
    	      dataType: "json",
    	      success: function (data) {
						console.log(data);
    	      }
	      });   */
		  /* $.ajax({
    	      url: webhost+"/odata.svc/ResultHistory(5381009906335744)",
    	      type: "PUT",
    	      async:false,
    	      //contentType: "application/json;odata=verbose",
    	      contentType: 'application/json; charset=utf-8',
    	      data: JSON.stringify({"processingDuration":20}),
    	      dataType: "json",
    	      success: function (data) {
						console.log(data);
    	      }
	      });    */
    
  });
  
  </script>
    <h1>Convergent API</h1>
    <table>
      <tr>
        <td colspan="2" style="font-weight:bold;">Available Servlets:</td>        
      </tr>
      <tr>
        <td><a href="imagegae">Convergent API Test Suits</a></td>
      </tr>
    </table>
    
    <form id="action1" action=""  method="post" enctype="multipart/form-data" onsubmit="return AIM.submit(this, {'onStart' : startCallback, 'onComplete' : completeCallback})">
    <input type="hidden" name="submissionId" class="submissionid" value="">
	<input type="file" name="form[file]" accept="image/*"/>
	  <input type="submit" id="form1" name="image1" value="Upload">
	</form>
	<form id="action2" action=""  method="post" enctype="multipart/form-data" onsubmit="return AIM.submit(this, {'onStart' : startCallback, 'onComplete' : completeCallback})">
	 <input type="hidden" name="submissionId" class="submissionid" value="">
	<input type="file" name="form[file]" accept="image/*"/>
	  <input type="submit" id="form2" name="image2" value="Upload">
	</form>
	<form id="action3" action=""  method="post" enctype="multipart/form-data" onsubmit="return AIM.submit(this, {'onStart' : startCallback, 'onComplete' : completeCallback})">
	 <input type="hidden" name="submissionId" class="submissionid" value="">
	<input type="file" name="form[file]" accept="image/*"/>
	  <input type="submit" id="form3" name="image3" value="Upload">
	</form>
  </body>
</html>